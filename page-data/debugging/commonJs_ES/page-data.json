{"componentChunkName":"component---src-templates-post-template-tsx","path":"/debugging/commonJs_ES/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p>CAPTCHA 기능을 구현하기 위해 react-simple-captcha를 설치했는데, 페이지를 새로고침할 때 다음과 같은 오류가 발생했습니다</p>\n</blockquote>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token literal-property property\">digest</span><span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span>\r\n<span class=\"token punctuation\">}</span>\r\nerror <span class=\"token operator\">-</span> <span class=\"token constant\">C</span><span class=\"token operator\">:</span>\\Users\\Desktop\\파일명\\node_modules\\react<span class=\"token operator\">-</span>simple<span class=\"token operator\">-</span>captcha\\react<span class=\"token operator\">-</span>simple<span class=\"token operator\">-</span>captcha<span class=\"token punctuation\">.</span>js<span class=\"token operator\">:</span><span class=\"token number\">1</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token operator\">^</span><span class=\"token operator\">^</span><span class=\"token operator\">^</span><span class=\"token operator\">^</span><span class=\"token operator\">^</span><span class=\"token operator\">^</span>\r\n<span class=\"token literal-property property\">SyntaxError</span><span class=\"token operator\">:</span> Cannot use <span class=\"token keyword\">import</span> statement outside a module</code></pre></div>\n<br/>\n<blockquote>\n<p>조사해본 결과, 이 오류는 CommonJS 환경에서 ES 모듈을 사용하려고 할 때 발생하는 문제라는 것을 알게 되었습니다. <br/>\r\nreact-simple-captcha는 CommonJS 모듈로 작성되어 있으며, ES 모듈을 사용하는 환경에서는 CommonJS가 제대로 동작하지 않기 때문입니다.</p>\n</blockquote>\n <br/>\n<p>🔗 참고 : [<a href=\"https://ellajang.github.io/frontendCoreTech/captcha/\" target=\"_blank\" rel=\"nofollow\">https://ellajang.github.io/frontendCoreTech/captcha/</a>]</p>\n<h3>1. ES 모듈과 CommonJS란?</h3>\n<p> 문제를 해결하기 앞서 CommonJS와 ES모듈이 어떤 것이길래 에러가 발생한건지 알아보겠습니다.</p>\n<br/>\r\n<br/>\n<blockquote>\n<h5>ES 모듈</h5>\n</blockquote>\n<p>: ES 모듈(ECMAScript Modules)은 최신 JavaScript 표준에서 모듈화를 지원하는 방식입니다. <br/>\r\nES6(ES2015)에서 도입된 이 모듈 시스템은 import와 export 키워드를 사용하여 다른 파일에서 모듈을 가져오거나 내보낼 수 있습니다.\r\n이 모듈 시스템은 브라우저에서도 기본적으로 지원되며, 자바스크립트의 모듈화와 코드 분할을 더욱 깔끔하게 관리할 수 있게 합니다.<br/><br/></p>\n<p><strong>예시</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">myFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ES Modules!'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> myFunction <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./myModule.js'</span></code></pre></div>\n<br/>\n<blockquote>\n<h5>CommonJS</h5>\n</blockquote>\n<p>: CommonJS는 ES 모듈이 등장하기 이전부터 Node.js에서 사용하던 모듈 시스템입니다. <br/>\r\nmodule.exports와 require 키워드를 사용하여 모듈을 내보내고 가져올 수 있습니다. 주로 서버 사이드에서 많이 사용되며, 브라우저 환경에서는 ES 모듈이 기본적으로 지원되기 때문에 일부 호환성 문제가 발생할 수 있습니다.</p>\n<br/>\n<p><strong>예시</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">myFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'CommonJS!'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> myFunction\r\n\r\n<span class=\"token keyword\">const</span> myFunction <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./myModule'</span><span class=\"token punctuation\">)</span></code></pre></div>\n <br/>\r\n📍 이처럼 두 모듈 시스템은 서로 다른 방식으로 모듈을 정의하고 가져오기 때문에, react-simple-captcha와 같은 CommonJS 모듈을 Next.js와 같은 ES 모듈 기반 프로젝트에서 사용하려고 할 때 \r\n    충돌이 발생할 수 있습니다.\n<h3>2. 에러 해결 방법</h3>\n<p> 이 문제를 해결하기 위해, 특정 노드 모듈을 Transpiling할 수 있는 패키지인 next-transpile-modules을 설치 후 next.comfig.js에 아래 코드를 추가했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">npm install <span class=\"token operator\">--</span>save next<span class=\"token operator\">-</span>transpile<span class=\"token operator\">-</span>modules</code></pre></div>\n<p><strong>또는</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">yarn add next<span class=\"token operator\">-</span>transpile<span class=\"token operator\">-</span>modules</code></pre></div>\n<p><strong>다음으로, next.config.js 파일에 react-simple-captcha를 트랜스파일링할 수 있도록 설정합니다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">const</span> withTM <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next-transpile-modules'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'react-simple-captcha'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//추가해줍니다.</span>\r\n\r\n<span class=\"token comment\">/** @type {import('next').NextConfig} */</span>\r\n\r\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">withTM</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p> 이 설정을 통해 CommonJS로 작성된 react-simple-captcha 모듈을 ES 모듈로 변환하여 사용할 수 있게 됩니다.</p>\n<br/>\n<blockquote>\n<h5>a. Transpiler란</h5>\n</blockquote>\n<p>: Transpiler는 코드를 변환하는 도구를 말합니다. 쉽게 말해, 이는 특정 환경에서 사용 가능한 라이브러리를 다른 환경에서도 호환되도록 도와주는 도구입니다.<br/>\r\n예를 들어, JavaScript의 ES6 문법을 ES5로 변환하거나, React의 JSX 및 TypeScript 코드를 브라우저가 이해할 수 있는 JavaScript로 변환하는 도구입니다. 대표적인 transpiler로는 Babel과 SWC가 있습니다.\r\n<br/><br/></p>\n<blockquote>\n<h5>b. next-transpile-modules란</h5>\n</blockquote>\n<p>: Next.js에서 외부 라이브러리의 소스 코드를 ES 모듈로 Transpiling(변환)해주는 도구입니다.<br/>\r\n기본적으로 Next.js는 ES 모듈을 사용하는데, 일부 외부 라이브러리는 여전히 CommonJS 형식으로 작성된 경우가 있습니다. 이때 발생하는 호환성 문제를 해결하기 위해 next-transpile-modules을 사용하여 CommonJS 형식의 라이브러리를 ES 모듈로 변환하여 사용할 수 있게 합니다.</p>\n<h3>3. 마무리</h3>\n<p> 이 문제를 해결하면서 자바스크립트의 모듈 시스템에 대한 이해도를 높일 수 있었고, 앞으로 다른 라이브러리나 패키지를 사용할 때에도 모듈 형식에 주의를 기울여야 한다는 점을 알게 되었습니다.<br/>\r\n이를 통해 프로젝트 환경에 맞는 도구와 설정을 선택하는 것이 중요하다는 것과 특히, 다양한 모듈 시스템을 사용하는 여러 라이브러리들이 공존하는 환경에서는 이와 같은 호환성 문제를 사전에 방지하기 위해\r\n모듈 형식을 확인하고 적절한 트랜스파일링 도구를 적용하는 것이 매우 중요하다는 것을 깨달았습니다.</p>","frontmatter":{"title":"[Next] next-transpile-modules로 Next.js에서 CommonJS와 ES 모듈 충돌 해결하기","summary":"CAPTCHA 기능을 구현하기 위해 react-simple-captcha를 설치했는데, 페이지를 새로고침할 때 다음과 같은 오류가 발생했습니다. 이 에러의 발생이유와 해결한 방법에 대한 설명입니다.","date":"2024.05.03.","categories":["All"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA60lEQVR42p2SO07DQBRFvRca9kFBwxbYDhVrYBFQBs/YE7BSICQLhJQPno/tyURKEBXQoIPsuKBInE9x9TR6elfvnbmRkZ7dqjv5f3Wzor0MRcDIOTat23qUoW4kmuESp95w6hWnXjDSoXtMo74ztVjgVE6dDVjlV/hRSqme0e3GBxmuT7NJQfWQ8T07gxDxYy+os0dsMsHIsJHnVsNCBFw6pRrGfE1P4fOcX3/CfHSLS8doGVosBzBsNjQdvxs+9CXL/Jpy+IRNdNvXx/xyM1yIBfHdgMm9xyWmNzp7xGbN6j2u0LLq3ttj8wd8vHNcWibooAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/54305603eb214d087f016d798d77a64d/becf2/debugging.png","srcSet":"/static/54305603eb214d087f016d798d77a64d/1c872/debugging.png 175w,\n/static/54305603eb214d087f016d798d77a64d/3fd51/debugging.png 350w,\n/static/54305603eb214d087f016d798d77a64d/becf2/debugging.png 700w","sizes":"(min-width: 700px) 700px, 100vw"},"sources":[{"srcSet":"/static/54305603eb214d087f016d798d77a64d/5a1f0/debugging.webp 175w,\n/static/54305603eb214d087f016d798d77a64d/bb551/debugging.webp 350w,\n/static/54305603eb214d087f016d798d77a64d/efd8f/debugging.webp 700w","type":"image/webp","sizes":"(min-width: 700px) 700px, 100vw"}]},"width":700,"height":300}},"publicURL":"/static/54305603eb214d087f016d798d77a64d/debugging.png"}}}}]}},"pageContext":{"slug":"/debugging/commonJs_ES/"}},"staticQueryHashes":[],"slicesMap":{}}